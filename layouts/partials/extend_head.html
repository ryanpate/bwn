<!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5523870768931777"
    crossorigin="anonymous"></script>

<!-- Load custom CSS -->
{{ $heroCSS := resources.Get "css/extended/hero.css" | minify }}
<link href="{{ $heroCSS.RelPermalink }}" rel="stylesheet">
{{ $customCSS := resources.Get "css/extended/custom.css" | minify }}
<link href="{{ $customCSS.RelPermalink }}" rel="stylesheet">

{{- /* Resolve description */ -}}
{{- $desc := .Params.seo.meta_description | default .Params.description | default .Summary | default
.Site.Params.description -}}
<meta name="description" content="{{ $desc }}">

{{- /* Canonical URL */ -}}
{{- $canon := .Params.canonicalURL | default .Permalink -}}
<link rel="canonical" href="{{ $canon }}" />

{{- /* Pick an OG image */ -}}
{{- $pageImg := (index .Params.images 0) | default .Params.cover.image -}}
{{- $siteImg := .Site.Params.images | default slice -}}
{{- $ogimg := $pageImg | default (index $siteImg 0) | default .Site.Params.cover.defaultImage -}}

<!-- Open Graph -->
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ $desc }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ $canon }}">
{{- if $ogimg }}
<meta property="og:image" content="{{ $ogimg | absURL }}">{{ end }}
<meta property="og:site_name" content="{{ .Site.Title }}">

<!-- Twitter/X Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ .Title }}">
<meta name="twitter:description" content="{{ $desc }}">
{{- if $ogimg }}
<meta name="twitter:image" content="{{ $ogimg | absURL }}">{{ end }}

<!-- Site Verification Tags (if configured) -->
{{- with .Site.Params.googleSiteVerificationTag }}
<meta name="google-site-verification" content="{{ . }}">
{{- end }}
{{- with .Site.Params.bingSiteVerificationTag }}
<meta name="msvalidate.01" content="{{ . }}">
{{- end }}
{{- with .Site.Params.yandexSiteVerificationTag }}
<meta name="yandex-verification" content="{{ . }}">
{{- end }}

<!-- Theme Color -->
<meta name="theme-color" content="#667eea">

<!-- Article JSON-LD (posts only) -->
{{ if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "headline": {{ .Title | jsonify }},
  "datePublished": "{{ .PublishDate | default .Date }}",
  "dateModified": "{{ .Lastmod }}",
  "mainEntityOfPage": {{ $canon | jsonify }},
  "author": {
    "@type": "Organization",
    "name": "BlockWire News"
  },
  "publisher": {
    "@type": "Organization",
    "name": "BlockWire News",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ "/img/logo.png" | absURL }}"
    }
  },
  "description": {{ $desc | jsonify }}{{ if $ogimg }},
  "image": "{{ $ogimg | absURL }}"{{ end }}
}
</script>
{{ end }}

<!-- WebSite JSON-LD (homepage only) -->
{{ if .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ .Site.Title }}",
  "description": "{{ .Site.Params.description }}",
  "url": "{{ .Site.BaseURL }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ .Site.BaseURL }}search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{{ end }}

<!-- Reading time calculation for posts -->
{{ if .IsPage }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const content = document.querySelector('.post-content');
        if (content) {
            const text = content.innerText;
            const wordsPerMinute = 200;
            const wordCount = text.split(/\s+/).length;
            const readingTime = Math.ceil(wordCount / wordsPerMinute);

            // Add reading time to post meta
            const postMeta = document.querySelector('.post-meta');
            if (postMeta && !postMeta.querySelector('.reading-time')) {
                const readingTimeEl = document.createElement('span');
                readingTimeEl.className = 'reading-time';
                readingTimeEl.innerHTML = `ðŸ“š ${readingTime} min read`;
                postMeta.appendChild(readingTimeEl);
            }
        }
    });
</script>
{{ end }}

<!-- Include reading progress bar for posts -->
{{ if .IsPage }}
{{ partial "reading-progress.html" . }}
{{ end }}

<!-- Preconnect to external domains for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://api.coingecko.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net">

<!-- Custom fonts (optional) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
    /* Apply Inter font */
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    /* Animated particles for all pages */
    .particles-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }

    .particle-bg {
        position: absolute;
        width: 2px;
        height: 2px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        animation: float-particle 20s infinite linear;
    }

    @keyframes float-particle {
        from {
            transform: translateY(100vh) translateX(0);
            opacity: 0;
        }

        10% {
            opacity: 1;
        }

        90% {
            opacity: 1;
        }

        to {
            transform: translateY(-100vh) translateX(100px);
            opacity: 0;
        }
    }

    /* Navigation Restructure Styles */
    header.nav,
    .nav {
        background: transparent !important;
        backdrop-filter: blur(10px) !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        box-shadow: none !important;
        padding: 1rem 2rem !important;
    }

    .nav-left {
        display: flex !important;
        align-items: center !important;
        gap: 1rem !important;
    }

    .nav-right {
        display: flex !important;
        align-items: center !important;
        margin-left: auto !important;
    }

    /* Style the theme toggle */
    .nav-left button,
    #theme-toggle {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        border-radius: 8px !important;
        padding: 0.5rem !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
    }

    .nav-left button:hover,
    #theme-toggle:hover {
        background: rgba(255, 255, 255, 0.2) !important;
    }

    /* Logo styling */
    .nav-left .logo a,
    .logo a {
        font-size: 1.5rem !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        text-transform: uppercase !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        text-decoration: none !important;
    }

    /* Add icon to logo */
    .nav-left .logo a::before,
    .logo a::before {
        content: '' !important;
        display: inline-block !important;
        width: 32px !important;
        height: 32px !important;
        background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;
        border-radius: 8px !important;
        flex-shrink: 0 !important;
    }

    /* Menu styling */
    .nav-right ul,
    .nav-right #menu,
    #menu {
        display: flex !important;
        gap: 1.5rem !important;
        list-style: none !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    .nav-right a,
    #menu a {
        color: rgba(255, 255, 255, 0.9) !important;
        text-decoration: none !important;
        padding: 0.5rem 1rem !important;
        border-radius: 8px !important;
        transition: all 0.3s ease !important;
        font-weight: 500 !important;
    }

    .nav-right a:hover,
    #menu a:hover {
        background: rgba(255, 255, 255, 0.15) !important;
        color: #ffffff !important;
    }
</style>

<!-- Navigation Restructure Script -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Wait a bit for PaperMod to initialize
        setTimeout(function () {
            // Find the navigation elements
            const nav = document.querySelector('header.nav') || document.querySelector('.nav');
            if (!nav) return;

            // Find the container
            const container = nav.querySelector('div') || nav;
            if (!container) return;

            // Find logo
            const logo = container.querySelector('.logo');

            // Find theme toggle - PaperMod uses an ID of 'theme-toggle'
            const themeToggle = document.getElementById('theme-toggle') ||
                container.querySelector('button[aria-label*="theme"]') ||
                container.querySelector('button');

            // Find menu
            const menu = document.getElementById('menu') ||
                container.querySelector('ul') ||
                container.querySelector('nav');

            // Only restructure if we have the elements
            if (!logo || !menu) return;

            // Create new container structure
            const leftContainer = document.createElement('div');
            leftContainer.className = 'nav-left';

            const rightContainer = document.createElement('div');
            rightContainer.className = 'nav-right';

            // Move theme toggle to left (if it exists)
            if (themeToggle) {
                const themeBtn = themeToggle.parentElement === container ? themeToggle : themeToggle.closest('button') || themeToggle;
                leftContainer.appendChild(themeBtn.cloneNode(true));
                themeBtn.style.display = 'none';
            }

            // Move logo to left
            leftContainer.appendChild(logo.cloneNode(true));

            // Move menu to right
            rightContainer.appendChild(menu.cloneNode(true));

            // Clear container and add new structure
            container.innerHTML = '';
            container.appendChild(leftContainer);
            container.appendChild(rightContainer);

            // Apply container styles
            container.style.cssText = 'display: flex !important; align-items: center !important; justify-content: space-between !important; width: 100% !important; padding: 0 !important;';

            // Re-attach theme toggle functionality
            const newThemeToggle = leftContainer.querySelector('#theme-toggle');
            if (newThemeToggle) {
                newThemeToggle.addEventListener('click', function () {
                    // Toggle theme - PaperMod's way
                    if (localStorage.getItem("pref-theme") === "dark") {
                        document.body.classList.remove('dark');
                        localStorage.setItem("pref-theme", 'light');
                    } else if (localStorage.getItem("pref-theme") === "light") {
                        document.body.classList.add('dark');
                        localStorage.setItem("pref-theme", 'dark');
                    } else {
                        // First time - check system preference
                        if (document.body.classList.contains('dark')) {
                            document.body.classList.remove('dark');
                            localStorage.setItem("pref-theme", 'light');
                        } else {
                            document.body.classList.add('dark');
                            localStorage.setItem("pref-theme", 'dark');
                        }
                    }
                });
            }
        }, 100);
    });
</script>

<!-- Generate background particles -->
<script>
    (function () {
        // Create particles container
        const particlesContainer = document.createElement('div');
        particlesContainer.className = 'particles-bg';
        document.body.appendChild(particlesContainer);

        // Generate particles
        const particleCount = 20;
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle-bg';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (20 + Math.random() * 10) + 's';
            particlesContainer.appendChild(particle);
        }
    })();

</script>