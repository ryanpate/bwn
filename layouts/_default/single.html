{{ define "head" }}
<style>
    .article{max-width:900px;margin:2rem auto;padding:0 2rem}
    .article-header{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid var(--border)}
    .article-title{font-size:2.5rem;font-weight:800;line-height:1.2;margin-bottom:1rem;background:linear-gradient(135deg,#fff,#a78bfa);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .article-meta{display:flex;gap:1.5rem;color:var(--text-muted);font-size:.9rem;flex-wrap:wrap}
    .article-content{font-size:1.125rem;line-height:1.8;color:rgba(255,255,255,.9)}
    body.light-theme .article-content{color:rgba(26,26,26,.9)}
    .article-content h2{margin:2rem 0 1rem;font-size:1.75rem;font-weight:700;color:#fff}
    body.light-theme .article-content h2{color:var(--text)}
    .article-content h3{margin:1.5rem 0 .75rem;font-size:1.5rem;font-weight:600;color:#fff}
    body.light-theme .article-content h3{color:var(--text)}
    .article-content p{margin-bottom:1.5rem}
    .article-content a{color:var(--primary);text-decoration:underline;text-underline-offset:2px;transition:color .3s ease}
    .article-content a:hover{color:#a78bfa}
    .article-content blockquote{margin:2rem 0;padding:1rem 1.5rem;background:rgba(139,92,246,.1);border-left:4px solid var(--primary);font-style:italic}
    .article-content ul,.article-content ol{margin-bottom:1.5rem;padding-left:2rem}
    .article-content li{margin-bottom:.5rem}
    .article-content code{background:rgba(139,92,246,.1);padding:.2rem .4rem;border-radius:4px;font-size:.9em}
    .article-content pre{background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:8px;padding:1rem;overflow-x:auto;margin-bottom:1.5rem}
    body.light-theme .article-content pre{background:rgba(0,0,0,.05)}
    .article-tags{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border);display:flex;gap:.5rem;flex-wrap:wrap}
    .tag{background:rgba(139,92,246,.1);border:1px solid rgba(139,92,246,.3);padding:.5rem 1rem;border-radius:20px;color:var(--primary);text-decoration:none;transition:all .3s ease;font-size:.9rem}
    .tag:hover{background:rgba(139,92,246,.2);transform:translateY(-2px)}
    .article-nav{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border);display:grid;grid-template-columns:1fr 1fr;gap:2rem}
    .article-nav-item{padding:1rem;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:12px;text-decoration:none;color:inherit;transition:all .3s ease}
    body.light-theme .article-nav-item{background:rgba(0,0,0,.02)}
    .article-nav-item:hover{background:rgba(255,255,255,.08);transform:translateY(-2px)}
    body.light-theme .article-nav-item:hover{background:rgba(0,0,0,.05)}
    .article-nav-label{font-size:.875rem;color:var(--text-muted);margin-bottom:.5rem}
    .article-nav-title{font-weight:600}
    .related{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border)}
    .related h3{font-size:1.25rem;margin-bottom:1rem}
    .related-list{display:grid;gap:1rem}
    .related-item{display:block;padding:1rem;border:1px solid var(--border);border-radius:12px;background:rgba(255,255,255,.04);text-decoration:none;color:inherit}
    .related-item:hover{background:rgba(255,255,255,.08)}
    .article-ad-top,.article-ad-bottom{margin:2rem 0;padding:1rem;background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:12px;min-height:100px;position:relative;text-align:center}
    body.light-theme .article-ad-top,body.light-theme .article-ad-bottom{background:rgba(0,0,0,.02)}
    .article-ad-top::before,.article-ad-bottom::before{content:'Advertisement';position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--background);padding:0 .5rem;font-size:.75rem;color:rgba(255,255,255,.3);text-transform:uppercase;letter-spacing:.1em}
    body.light-theme .article-ad-top::before,body.light-theme .article-ad-bottom::before{background:var(--background);color:rgba(0,0,0,.3)}
    @media(max-width:768px){.article-title{font-size:2rem}.article{padding:0 1rem}.article-nav{grid-template-columns:1fr}}
</style>

<!-- Canonical -->
<link rel="canonical" href="{{ .Permalink }}"/>

<!-- NewsArticle JSON-LD with Enhanced Schema -->
{{/* Select a best-image: page param > resources > site param fallback */}}
{{ $img := "" }}
{{ with .Params.images }}
  {{ $img = (index . 0) }}
{{ else }}
  {{ with .Resources.GetMatch "feature*" }}{{ $img = .Permalink }}{{ end }}
{{ end }}
{{ if not $img }}
  {{ with .Site.Params.images }}{{ $img = (index . 0) | absURL }}{{ end }}
{{ end }}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "headline": {{ .Title | jsonify }},
  "description": {{ ( .Params.description | default .Site.Params.description ) | jsonify }},
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  "author": {
    "@type": "Organization",
    "name": {{ .Site.Title | jsonify }},
    "url": {{ .Site.BaseURL | jsonify }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ .Site.Title | jsonify }},
    "url": {{ .Site.BaseURL | jsonify }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ (or ($img | absURL) (.Site.Params.images | default (slice) | first | absURL)) | jsonify }},
      "width": 600,
      "height": 60
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  {{ with .Params.categories }}"articleSection": {{ index . 0 | jsonify }},{{ end }}
  {{ with .Params.tags }}"keywords": {{ delimit . ", " | jsonify }},{{ end }}
  {{ if $img }}"image": {
    "@type": "ImageObject",
    "url": {{ $img | absURL | jsonify }},
    "width": 1200,
    "height": 630
  },{{ end }}
  "wordCount": {{ .WordCount }},
  "articleBody": {{ .Plain | jsonify }},
  "inLanguage": "en-US",
  "isAccessibleForFree": true,
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [".article-title", ".article-content"]
  }
}
</script>

<!-- BreadcrumbList Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": {{ .Site.BaseURL | jsonify }}
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "News",
      "item": {{ (printf "%snews/" .Site.BaseURL) | jsonify }}
    }{{ with .Params.categories }},
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ index . 0 | jsonify }},
      "item": {{ (printf "%scategories/%s/" $.Site.BaseURL (index . 0 | urlize)) | jsonify }}
    }{{ end }},
    {
      "@type": "ListItem",
      "position": {{ if .Params.categories }}4{{ else }}3{{ end }},
      "name": {{ .Title | jsonify }},
      "item": {{ .Permalink | jsonify }}
    }
  ]
}
</script>

<!-- FAQ Schema (if FAQ content exists) -->
{{ if .Params.faq }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {{ range $index, $item := .Params.faq }}
    {{ if $index }},{{ end }}
    {
      "@type": "Question",
      "name": {{ $item.question | jsonify }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ $item.answer | jsonify }}
      }
    }
    {{ end }}
  ]
}
</script>
{{ end }}
{{ end }}

{{ define "main" }}
<article class="article" itemscope itemtype="https://schema.org/NewsArticle">
  <header class="article-header">
    <h1 class="article-title" itemprop="headline">{{ .Title }}</h1>
    <div class="article-meta">
      <span>üìÖ <time itemprop="datePublished" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">{{ .Date.Format "January 2, 2006" }}</time></span>
      <span>üìö {{ .ReadingTime }} min read</span>
      {{ with .Params.author }}<span>‚úçÔ∏è {{ . }}</span>{{ end }}
      {{ with .Params.categories }}<span>üè∑Ô∏è {{ delimit . ", " }}</span>{{ end }}
    </div>
  </header>

  <div class="article-content" itemprop="articleBody">
    <!-- Top of article ad - In-article Ad -->
    <div class="article-ad-top">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-5523870768931777"
           data-ad-slot="9173395704"
           data-ad-format="rectangle"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    {{ .Content }}

    <!-- Bottom of article ad - In-article Ad -->
    <div class="article-ad-bottom">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-5523870768931777"
           data-ad-slot="9173395704"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </div>

  {{ with .Params.tags }}
  <div class="article-tags">
    {{ range . }}
      <a href="/tags/{{ . | urlize }}/" class="tag">#{{ . }}</a>
    {{ end }}
  </div>
  {{ end }}

  <!-- Related reading: prefer tag overlap, then category overlap, exclude self -->
  {{ $current := . }}
  {{ $byTags := slice }}
  {{ with .Params.tags }}
    {{ $tags := . }}
    {{ $pool := where $.Site.RegularPages "Section" "news" }}
    {{ $pool = where $pool "Permalink" "ne" $current.Permalink }}
    {{ $byTags = first 6 (where $pool "Params.tags" "intersect" $tags) }}
  {{ end }}

  {{ $related := $byTags }}
  {{ if lt (len $related) 3 }}
    {{ $need := sub 3 (len $related) }}
    {{ $cats := $current.Params.categories | default (slice) }}
    {{ $pool2 := where $.Site.RegularPages "Section" "news" }}
    {{ $pool2 = where $pool2 "Permalink" "ne" $current.Permalink }}
    {{ $byCats := where $pool2 "Params.categories" "intersect" $cats }}
    {{ $related = uniq (append $related (first $need $byCats)) }}
  {{ end }}

  {{ if gt (len $related) 0 }}
  <section class="related">
    <h3>Related reading</h3>
    <div class="related-list">
      {{ range first 3 $related }}
      <a class="related-item" href="{{ .Permalink }}">
        <strong>{{ .Title }}</strong><br/>
        <small>{{ .Date.Format "Jan 2, 2006" }} ‚Ä¢ {{ .ReadingTime }} min read</small>
      </a>
      {{ end }}
    </div>
  </section>
  {{ end }}

  <!-- Article Navigation -->
  <nav class="article-nav">
    {{ with .PrevInSection }}
    <a href="{{ .Permalink }}" class="article-nav-item">
      <div class="article-nav-label">‚Üê Previous</div>
      <div class="article-nav-title">{{ .Title }}</div>
    </a>
    {{ else }}<div></div>{{ end }}

    {{ with .NextInSection }}
    <a href="{{ .Permalink }}" class="article-nav-item" style="text-align:right;">
      <div class="article-nav-label">Next ‚Üí</div>
      <div class="article-nav-title">{{ .Title }}</div>
    </a>
    {{ else }}<div></div>{{ end }}
  </nav>
</article>
{{ end }}